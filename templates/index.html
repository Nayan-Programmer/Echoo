<!-- Bas header-actions me button aur script add hue hain, baaki UI same hai -->
<div class="header-actions">
    <button class="header-btn" id="googleSignInBtn">Sign in with Google</button>
    <button class="header-btn">Settings</button>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
let currentUser = null;

function startChat(){
    document.getElementById('welcomeScreen').style.display='none';
    document.getElementById('chatArea').style.display='flex';
}

async function sendMessage(){
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if(!text) return;

    const container = document.getElementById('messagesContainer');

    const userMessage = document.createElement('div');
    userMessage.className='message user';
    userMessage.innerHTML = `
        <div class="message-content">
            <div class="message-avatar user-avatar">${currentUser?currentUser.charAt(0):'U'}</div>
            <div class="message-bubble user"><div class="message-text">${text}</div></div>
        </div>`;
    container.appendChild(userMessage);
    input.value='';
    container.scrollTop=container.scrollHeight;

    try{
        const response = await fetch("/chat", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({message:text})
        });
        const data = await response.json();
        const aiText = data.reply;

        const aiMessage = document.createElement('div');
        aiMessage.className='message ai';
        aiMessage.innerHTML = `
            <div class="message-content">
                <div class="message-avatar ai-avatar">AI</div>
                <div class="message-bubble ai"><div class="message-text">${aiText}</div></div>
            </div>`;
        container.appendChild(aiMessage);
        container.scrollTop=container.scrollHeight;
    } catch(err){
        console.error(err);
        const errorMessage = document.createElement('div');
        errorMessage.className='message ai';
        errorMessage.innerHTML = `
            <div class="message-content">
                <div class="message-avatar ai-avatar">AI</div>
                <div class="message-bubble ai"><div class="message-text">Error contacting AI server.</div></div>
            </div>`;
        container.appendChild(errorMessage);
        container.scrollTop=container.scrollHeight;
    }
}

// Google Sign-In
window.onload = function() {
    google.accounts.id.initialize({
        client_id: "YOUR_GOOGLE_CLIENT_ID",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
        document.getElementById("googleSignInBtn"),
        { theme: "outline", size: "medium" }
    );
};

function handleCredentialResponse(response){
    const payload = JSON.parse(atob(response.credential.split('.')[1]));
    currentUser = payload.name || payload.email || "User";
    alert(`Logged in as ${currentUser}`);
    document.getElementById("googleSignInBtn").style.display="none";
}
</script>
