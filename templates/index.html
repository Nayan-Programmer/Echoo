<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EchooAI - AI Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Tumhara existing UI CSS yahan paste karo */
</style>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
<div class="app">
    <!-- Header & UI maintained -->
    <main class="main-content">
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
                <h2 class="welcome-title">Welcome to EchooAI</h2>
                <p class="welcome-description" id="welcomeUserName">Sign in to start chatting!</p>
                <div id="googleSignInDiv"></div>
            </div>
        </div>

        <div class="chat-area" id="chatArea" style="display:none;">
            <div class="messages-container" id="messagesContainer"></div>
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <div class="input-area">
                        <textarea id="messageInput" placeholder="Type your message..."></textarea>
                        <button class="send-btn" onclick="sendMessage()">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
let userName = "Guest";
let userEmail = "guest@example.com";

function handleCredentialResponse(response){
    const data = JSON.parse(atob(response.credential.split('.')[1]));
    userName = data.name;
    userEmail = data.email;
    document.getElementById('welcomeUserName').innerText = `Hello, ${userName}`;
    document.getElementById('welcomeScreen').style.display='none';
    document.getElementById('chatArea').style.display='flex';
}

window.onload = function(){
    google.accounts.id.initialize({
        client_id:"271512740425-7i1eemcfj0g5ksitn4uu70n11jvc0pou.apps.googleusercontent.com",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
        document.getElementById("googleSignInDiv"),
        { theme:"outline", size:"large", type:"standard" }
    );
}

async function sendMessage(){
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if(!text) return;
    const container = document.getElementById('messagesContainer');

    const userMessage = document.createElement('div');
    userMessage.className='message user';
    userMessage.innerHTML = `<div class="message-content">
        <div class="message-avatar user-avatar">U</div>
        <div class="message-bubble user"><div class="message-text">${text}</div></div>
    </div>`;
    container.appendChild(userMessage);
    input.value='';
    container.scrollTop=container.scrollHeight;

    try{
        const response = await fetch("/chat", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({message:text,user_name:userName,user_email:userEmail})
        });
        const data = await response.json();
        const aiText = data.reply;
        const aiMessage = document.createElement('div');
        aiMessage.className='message ai';
        aiMessage.innerHTML = `<div class="message-content">
            <div class="message-avatar ai-avatar">AI</div>
            <div class="message-bubble ai"><div class="message-text">${aiText}</div></div>
        </div>`;
        container.appendChild(aiMessage);
        container.scrollTop=container.scrollHeight;
    }catch(err){console.error(err);}
}
</script>
</body>
</html>
