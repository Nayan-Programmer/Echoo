<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EchooAI - AI Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family:'Inter', system-ui, sans-serif;color:#fff;background:#000;overflow-x:hidden;}
    :root {
        --primary-500:hsl(172.4, 82.8%, 36.1%);
        --emerald-500:hsl(160, 84.1%, 39.4%);
        --glass-bg:rgba(255,255,255,0.1);
        --glass-dark-bg:rgba(30,41,59,0.8);
        --glass-dark-border:rgba(148,163,184,0.1);
        --radius:1.3rem;
    }
    .background-gradient {position:fixed;inset:0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);opacity:0.9;z-index:-2;}
    .background-overlay {position:fixed;inset:0;background-image:url('https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080');background-size:cover;background-position:center;opacity:0.05;z-index:-1;}
    .app {min-height:100vh;display:flex;flex-direction:column;position:relative;}
    .header {background:var(--glass-dark-bg);backdrop-filter:blur(10px);border-bottom:1px solid var(--glass-dark-border);z-index:100;}
    .header-content {max-width:1536px;margin:0 auto;padding:0 1.5rem;display:flex;align-items:center;justify-content:space-between;height:4rem;}
    .logo-section {display:flex;align-items:center;gap:.75rem;}
    .logo-icon {
        width:1.8rem;height:1.8rem;
        border-radius:var(--radius);
        background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);
        display:flex;align-items:center;justify-content:center;
        box-shadow:0 10px 25px rgba(0,0,0,0.2);
    }
    .logo-img {width:1rem;height:1rem;border-radius:.25rem;}
    .logo-text h1 {font-size:1.25rem;font-weight:700;color:white;margin:0;}
    .logo-text p {font-size:.8rem;color:#aaa;margin:0;}
    .header-actions {display:flex;align-items:center;gap:.75rem;}
    .header-btn {padding:.5rem 1rem;border-radius:.5rem;background:var(--glass-bg);border:1px solid var(--glass-dark-border);color:white;cursor:pointer;transition:.2s;}
    .header-btn:hover {background:rgba(255,255,255,0.2);transform:translateY(-1px);}
    .main-content {flex:1;display:flex;flex-direction:column;max-width:64rem;margin:0 auto;width:100%;padding:1.5rem;gap:1.5rem;}
    .welcome-screen {flex:1;display:flex;align-items:center;justify-content:center;}
    .welcome-content {text-align:center;max-width:32rem;margin:0 auto;}
    .welcome-logo {width:5rem;height:5rem;margin:0 auto 2rem;background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;}
    .welcome-logo-img {width:2rem;height:2rem;border-radius:.5rem;}
    .welcome-title {font-size:2.5rem;font-weight:700;color:white;margin-bottom:1rem;}
    .welcome-description {font-size:1.25rem;color:#d1d5db;margin-bottom:2rem;}
    .start-chat-btn {padding:1rem 2rem;background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);color:white;font-weight:600;border:none;border-radius:var(--radius);cursor:pointer;}
    .chat-area {flex:1;display:flex;flex-direction:column;}
    .messages-container {flex:1;background:var(--glass-dark-bg);border:1px solid var(--glass-dark-border);border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem;min-height:400px;max-height:60vh;overflow-y:auto;}
    .message {display:flex;margin-bottom:1rem;}
    .message.user {justify-content:flex-end;}
    .message-content {max-width:70%;display:flex;align-items:flex-start;gap:.75rem;}
    .message.user .message-content {flex-direction:row-reverse;}
    .message-avatar {width:2rem;height:2rem;border-radius:.5rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
    .ai-avatar {background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);color:white;}
    .user-avatar {background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%);color:white;font-size:.75rem;font-weight:600;}
    .message-bubble {border-radius:1rem;padding:.75rem 1rem;}
    .message-bubble.ai {background:rgba(248,250,252,0.9);color:#374151;}
    .message-bubble.user {background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);color:white;}
    .message-text {white-space:pre-wrap;line-height:1.5;}
    .message-input-wrapper {background:var(--glass-dark-bg);border:1px solid var(--glass-dark-border);border-radius:1rem;padding:1rem;}
    .input-area {display:flex;align-items:flex-end;gap:1rem;}
    #messageInput {flex:1;background:rgba(255,255,255,0.1);border:none;border-radius:var(--radius);padding:.75rem 1rem;color:white;font-size:1rem;resize:none;min-height:2.75rem;}
    .send-btn {background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);border:none;border-radius:var(--radius);padding:.75rem;color:white;cursor:pointer;}
    .footer {background:var(--glass-dark-bg);border-top:1px solid var(--glass-dark-border);margin-top:auto;}
    .footer-content {max-width:64rem;margin:0 auto;padding:1rem 1.5rem;display:flex;align-items:center;justify-content:space-between;font-size:.875rem;color:#9ca3af;}
    .status-indicator {width:.5rem;height:.5rem;background:var(--emerald-500);border-radius:50%;}
</style>
</head>
<body>
<div class="app">
    <div class="background-gradient"></div>
    <div class="background-overlay"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo-img">
                </div>
                <div class="logo-text">
                    <h1>EchooAI</h1>
                    <p>Premium Chatbot</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn" onclick="loginWithGoogle()">Login with Google</button>
                <button class="header-btn">Settings</button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
                <div class="welcome-logo">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="welcome-logo-img">
                </div>
                <h2 class="welcome-title">Welcome to EchooAI</h2>
                <p class="welcome-description">Your AI assistant for everything. Click below to start chatting!</p>
                <button class="start-chat-btn" onclick="startChat()">Start Chat</button>
            </div>
        </div>

        <div class="chat-area" id="chatArea" style="display:none;">
            <div class="messages-container" id="messagesContainer"></div>
            <div class="message-input-wrapper">
                <div class="input-area">
                    <textarea id="messageInput" placeholder="Type your message..."></textarea>
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <span>&copy; 2025 EchooAI</span>
            <div class="status-indicator"></div>
            <span>Online</span>
        </div>
    </footer>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const provider = new GoogleAuthProvider();

  let currentUser = null;

  async function loginWithGoogle() {
    try {
      const result = await signInWithPopup(auth, provider);
      currentUser = result.user;
      alert("Welcome " + currentUser.displayName);
      loadHistory(); // load old chats after login
    } catch (error) {
      console.error(error);
    }
  }
  window.loginWithGoogle = loginWithGoogle;

  function startChat(){
    document.getElementById('welcomeScreen').style.display='none';
    document.getElementById('chatArea').style.display='flex';
  }

  async function sendMessage(){
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if(!text) return;

    const container = document.getElementById('messagesContainer');
    container.innerHTML += `
      <div class="message user">
        <div class="message-content">
          <div class="message-avatar user-avatar">U</div>
          <div class="message-bubble user"><div class="message-text">${text}</div></div>
        </div>
      </div>`;
    input.value='';
    container.scrollTop=container.scrollHeight;

    try{
      const response = await fetch("/chat", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({message:text, user: currentUser ? currentUser.email : "guest"})
      });
      const data = await response.json();
      const aiText = data.reply;

      container.innerHTML += `
        <div class="message ai">
          <div class="message-content">
            <div class="message-avatar ai-avatar">AI</div>
            <div class="message-bubble ai"><div class="message-text">${aiText}</div></div>
          </div>
        </div>`;
      container.scrollTop=container.scrollHeight;
    } catch(err){
      console.error(err);
    }
  }
  window.sendMessage = sendMessage;

  async function loadHistory(){
    if(!currentUser) return;
    const container = document.getElementById('messagesContainer');
    container.innerHTML = "";
    try{
      const res = await fetch(`/history/${currentUser.email}`);
      const data = await res.json();
      data.reverse().forEach(row => {
        const [message, reply] = row;
        container.innerHTML += `
          <div class="message user">
            <div class="message-content">
              <div class="message-avatar user-avatar">U</div>
              <div class="message-bubble user"><div class="message-text">${message}</div></div>
            </div>
          </div>
          <div class="message ai">
            <div class="message-content">
              <div class="message-avatar ai-avatar">AI</div>
              <div class="message-bubble ai"><div class="message-text">${reply}</div></div>
            </div>
          </div>`;
      });
    } catch(e){ console.error(e); }
  }
</script>
</body>
</html>
