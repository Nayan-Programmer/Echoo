<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ assistant_name }} - AI Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* --- Global --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', system-ui, sans-serif; color: #fff; background: #000; overflow-x: hidden; }
    :root {
        --primary-500: hsl(172.4, 82.8%, 36.1%);
        --emerald-500: hsl(160, 84.1%, 39.4%);
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-dark-bg: rgba(30, 41, 59, 0.85);
        --glass-dark-border: rgba(148, 163, 184, 0.15);
        --radius: 1.2rem;
    }

    /* --- Backgrounds --- */
    .background-gradient { position: fixed; inset: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); opacity: 0.85; z-index: -2; }
    .background-overlay { position: fixed; inset: 0; background-image: url('https://images.unsplash.com/photo-1635070041078-e363dbe005cb?auto=format&fit=crop&w=1920&q=80'); background-size: cover; background-position: center; opacity: 0.05; z-index: -1; }

    .app { min-height: 100vh; display: flex; flex-direction: column; position: relative; }

    /* --- Header --- */
    .header { background: var(--glass-dark-bg); backdrop-filter: blur(12px); border-bottom: 1px solid var(--glass-dark-border); z-index: 100; }
    .header-content { max-width: 1280px; margin: 0 auto; padding: 0 1.25rem; display: flex; align-items: center; justify-content: space-between; height: 4rem; }
    .logo-section { display: flex; align-items: center; gap: .75rem; }
    .logo-icon { width: 1.8rem; height: 1.8rem; border-radius: var(--radius); background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
    .logo-img { width: 1rem; height: 1rem; border-radius: .25rem; }
    .logo-text h1 { font-size: 1.25rem; font-weight: 700; color: #fff; }
    .logo-text p { font-size: .75rem; color: #9ca3af; }
    .header-actions { display: flex; align-items: center; gap: .75rem; }
    .header-btn { padding: .5rem .9rem; border-radius: .6rem; background: var(--glass-bg); border: 1px solid var(--glass-dark-border); color: #fff; cursor: pointer; transition: .2s; text-decoration: none; font-size: 0.9rem; }
    .header-btn:hover { background: rgba(255,255,255,0.18); transform: translateY(-1px); }

    /* --- Sidebar --- */
    .sidebar {
        position: fixed; top: 0; left: -260px; height: 100%; width: 240px;
        background: var(--glass-dark-bg); backdrop-filter: blur(14px);
        border-right: 1px solid var(--glass-dark-border);
        padding: 2rem 1rem; display: flex; flex-direction: column; gap: 1.5rem;
        transition: left .35s ease; z-index: 200;
    }
    .sidebar.active { left: 0; }
    .sidebar h2, .sidebar h3 { font-size: 1rem; font-weight: 600; color: #f3f4f6; margin-bottom: .5rem; }
    .sidebar-chats { display: flex; flex-direction: column; gap: 0.35rem; overflow-y: auto; flex-grow: 1; }
    .sidebar a.chat-link {
        text-decoration: none; color: #d1d5db; font-size: .95rem; font-weight: 500;
        padding: .65rem .85rem; border-radius: .6rem; transition: .25s;
        display: flex; align-items: center; gap: .5rem;
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .sidebar a.chat-link:hover { background: rgba(255,255,255,0.15); color: #fff; transform: translateX(4px); }

    /* Hamburger */
    .hamburger { width: 2rem; height: 2rem; display: flex; flex-direction: column; justify-content: center; gap: .35rem; cursor: pointer; }
    .hamburger span { height: 3px; width: 100%; background: white; border-radius: 5px; transition: .3s; }
    .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
    .hamburger.active span:nth-child(2) { opacity: 0; }
    .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }

    /* --- Animations --- */
    @keyframes fadeIn { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
    @keyframes slideUp { 0% { transform: translateY(100%); } 100% { transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    /* --- Main Content --- */
    .main-content { flex: 1; display: flex; flex-direction: column; max-width: 64rem; margin: 0 auto; width: 100%; padding: 1.25rem; gap: 1.25rem; }

    .welcome-screen { flex: 1; display: flex; align-items: center; justify-content: center; animation: fadeIn .5s ease-in-out; }
    .welcome-content { text-align: center; max-width: 32rem; margin: 0 auto; }
    .welcome-logo { width: 5rem; height: 5rem; margin: 0 auto 2rem; background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 20px 40px rgba(0,0,0,0.35); }
    .welcome-logo-img { width: 2rem; height: 2rem; border-radius: .5rem; }
    .welcome-title { font-size: 2.2rem; font-weight: 700; margin-bottom: 1rem; }
    .welcome-description { font-size: 1.1rem; color: #cbd5e1; margin-bottom: 1.75rem; line-height: 1.6; }
    .login-btn { display: inline-flex; align-items: center; gap: .6rem; padding: 0.9rem 1.8rem; background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); color: #fff; font-weight: 600; border: none; border-radius: var(--radius); cursor: pointer; transition: .3s; box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-decoration: none; }
    .login-btn:hover { box-shadow: 0 16px 32px rgba(0,0,0,0.35); transform: scale(1.05); }

    /* --- Chat --- */
    .chat-area { flex: 1; display: flex; flex-direction: column; gap: 1rem; }
    .messages-container { flex: 1; overflow-y: auto; padding-right: .75rem; display: flex; flex-direction: column; gap: 1rem; max-height: calc(100vh - 12rem); scroll-behavior: smooth; }

    .message { display: flex; align-items: flex-start; gap: 0.75rem; animation: fadeIn 0.25s ease-in-out; }
    .message.user { justify-content: flex-end; }
    .message-content { display: flex; align-items: flex-end; max-width: 75%; }
    .message.user .message-content { flex-direction: row-reverse; }

    .message-avatar { width: 2.2rem; height: 2.2rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.85rem; }
    .user-avatar { background: #555; }
    .ai-avatar { background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); }

    .message-bubble { padding: 0.85rem 1.15rem; border-radius: var(--radius); font-size: 0.95rem; line-height: 1.4; box-shadow: 0 2px 8px rgba(0,0,0,0.15); white-space: pre-wrap; }
    .message-bubble.user { background-color: rgba(255,255,255,0.2); border-bottom-right-radius: .5rem; }
    .message-bubble.ai { background-color: var(--glass-dark-bg); border-bottom-left-radius: .5rem; }

    .loading-indicator { opacity: 0.7; font-style: italic; color: #a0a0a0; animation: pulse 1.3s infinite; }

    /* Input */
    .message-input-container { width: 100%; display: flex; justify-content: center; padding: .75rem 0; }
    .message-input-wrapper { width: 100%; max-width: 64rem; background: var(--glass-dark-bg); border: 1px solid var(--glass-dark-border); backdrop-filter: blur(12px); border-radius: var(--radius); padding: .75rem; display: flex; align-items: center; gap: .75rem; animation: slideUp 0.35s ease; }
    .input-area { flex: 1; display: flex; gap: .75rem; }
    #messageInput { flex: 1; background: none; border: none; color: #fff; font-size: 1rem; resize: none; outline: none; }
    .send-btn { background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); border: none; color: #fff; padding: .65rem 1.3rem; border-radius: .65rem; font-weight: 600; cursor: pointer; transition: 0.25s; box-shadow: 0 4px 14px rgba(0,0,0,0.15); }
    .send-btn:hover { transform: scale(1.05); box-shadow: 0 8px 18px rgba(0,0,0,0.25); }

    /* --- Footer --- */
    .footer { background: var(--glass-dark-bg); backdrop-filter: blur(12px); border-top: 1px solid var(--glass-dark-border); padding: .9rem 1.25rem; font-size: 0.85rem; color: #9ca3af; }
    .footer-content { max-width: 1280px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .footer-link { color: #9ca3af; text-decoration: none; }
    .footer-link:hover { color: #fff; }
    .separator { width: 1px; height: 1rem; background-color: #4b5563; }
    .status-indicator { width: 0.5rem; height: 0.5rem; background-color: var(--primary-500); border-radius: 50%; }
</style>
</head>
<body>
<div class="app">
    <div class="background-gradient"></div>
    <div class="background-overlay"></div>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <h2>Menu</h2>
        {% if user_info %}
            <a href="#" onclick="newChat()">âž• New Chat</a>
            <a href="#" onclick="saveChat()">ðŸ’¾ Save Chat</a>
            <a href="/logout">ðŸšª Logout</a>
            <h3>Previous Chats</h3>
            <div class="sidebar-chats">
                {% for chat in all_chats %}
                    <a href="#" class="chat-link" onclick="loadChat({{ chat.id }})">{{ chat.title }}</a>
                {% endfor %}
            </div>
        {% else %}
            <a href="/google-login">ðŸšª Login</a>
            <p style="color:#9ca3af;font-size:0.85rem;">Login to save and access your chats.</p>
        {% endif %}
    </nav>

    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="https://placehold.co/100x100/A5C953/white?text=AI" alt="Logo" class="logo-img">
                </div>
                <div class="logo-text">
                    <h1>{{ assistant_name }}</h1>
                    <p>Premium Chatbot</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="hamburger" id="hamburger">
                    <span></span><span></span><span></span>
                </div>
                {% if user_info %}
                    <button class="header-btn">{{ user_info.given_name }}</button>
                {% else %}
                    <a href="/google-login" class="header-btn">Login</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="main-content">
        {% if user_info %}
            <div class="chat-area" id="chatArea">
                <div class="messages-container" id="messagesContainer"></div>
                <div class="message-input-container">
                    <div class="message-input-wrapper">
                        <div class="input-area">
                            <textarea id="messageInput" placeholder="Type your message..."></textarea>
                            <button class="send-btn" onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-logo">
                        <img src="https://placehold.co/100x100/A5C953/white?text=AI" alt="Logo" class="welcome-logo-img">
                    </div>
                    <h2 class="welcome-title">Welcome to {{ assistant_name }}</h2>
                    <p class="welcome-description">Please log in to start chatting and save your conversation history.</p>
                    <a href="/google-login" class="login-btn">Sign in with Google</a>
                </div>
            </div>
        {% endif %}
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <span>&copy; 2025 {{ developer_name }}</span>
                <div class="separator"></div>
                <a href="#" class="footer-link">Privacy</a>
            </div>
            <div class="footer-right">
                <div class="status-indicator"></div>
                <span class="status-text">Online</span>
            </div>
        </div>
    </footer>
</div>

<script>
    const currentChatHistory = JSON.parse('{{ current_chat|tojson }}');

    function addMessage(sender, text, isTyping = false) {
        const container = document.getElementById('messagesContainer');
        const messageElement = document.createElement('div');
        messageElement.className = `message ${sender}`;
        const avatarClass = sender === 'user' ? 'user-avatar' : 'ai-avatar';
        const avatarText = sender === 'user' ? 'U' : 'AI';
        messageElement.innerHTML = `
            <div class="message-content">
                <div class="message-avatar ${avatarClass}">${avatarText}</div>
                <div class="message-bubble ${sender}">
                    <div class="message-text ${is
