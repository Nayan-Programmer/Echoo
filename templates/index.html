<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EchooAI - AI Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* [same styles as before, unchanged for brevity] */
</style>
</head>
<body>
<div class="app">
    <div class="background-gradient"></div>
    <div class="background-overlay"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo-img">
                </div>
                <div class="logo-text">
                    <h1>EchooAI</h1>
                    <p>Premium Chatbot</p>
                </div>
            </div>
            <div class="header-actions">
                {% if user_info %}
                    <button class="header-btn" onclick="window.location.href='/logout'">Logout</button>
                {% else %}
                    <button class="header-btn" onclick="window.location.href='/google-login'">Sign in with Google</button>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Welcome screen -->
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
                <div class="welcome-logo">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="welcome-logo-img">
                </div>
                {% if user_info %}
                    <h2 class="welcome-title">Welcome, {{ user_info.get('name', 'User') }}! ðŸ‘‹</h2>
                    <p class="welcome-description">You're logged in. Click below to start chatting with EchooAI!</p>
                    <button class="start-chat-btn" onclick="startChat()">Start Chat</button>
                {% else %}
                    <h2 class="welcome-title">Welcome to EchooAI</h2>
                    <p class="welcome-description">Please sign in with Google to start chatting.</p>
                    <button class="start-chat-btn" onclick="window.location.href='/google-login'">Sign in with Google</button>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <h3 class="sidebar-heading">Previous Chats</h3>
            <div class="sidebar-list" id="chatList">
                {% for chat in chat_sessions %}
                <div class="sidebar-item" onclick="loadChat('{{ chat.id }}')">{{ chat.title }}</div>
                {% endfor %}
            </div>
        </div>

        <!-- Chat area -->
        <div class="chat-area" id="chatArea" style="display:none;">
            <div class="messages-container" id="messagesContainer">
                {% if active_chat %}
                    {% for chat in chat_sessions %}
                        {% if chat.id == active_chat %}
                            {% for message in chat.messages %}
                                <div class="message {% if message.sender == 'user' %}user{% else %}ai{% endif %}">
                                    <div class="message-content">
                                        <div class="message-avatar {% if message.sender == 'user' %}user-avatar{% else %}ai-avatar{% endif %}">
                                            {% if message.sender == 'user' %}{{ user_info.get('name', 'U') | first }}{% else %}AI{% endif %}
                                        </div>
                                        <div class="message-bubble {% if message.sender == 'user' %}user{% else %}ai{% endif %}">
                                            <div class="message-text">{{ message.message|safe }}</div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <div class="input-area">
                        <textarea id="messageInput" placeholder="Type your message..."></textarea>
                        <button class="send-btn" onclick="sendMessage()">Send</button>
                    </div>
                </div>

                <!-- Image generation -->
                <div class="message-input-wrapper" style="margin-top:1rem;">
                    <div class="input-area">
                        <input id="imagePrompt" placeholder="Enter image prompt..."/>
                        <button class="send-btn" onclick="generateImage()">Generate</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <span>&copy; 2025 EchooAI</span>
                <div class="separator"></div>
                <a href="#" class="footer-link">Privacy</a>
            </div>
            <div class="footer-right">
                <div class="status-indicator"></div>
                <span class="status-text">Online</span>
            </div>
        </div>
    </footer>
</div>

<script>
function startChat(){
    document.getElementById('welcomeScreen').style.display='none';
    document.getElementById('sidebar').style.display='flex';
    document.getElementById('chatArea').style.display='flex';
}

function appendMessage(sender, text){
    const container=document.getElementById('messagesContainer');
    const div=document.createElement('div');
    div.className='message '+(sender==='user'?'user':'ai');
    div.innerHTML=`
        <div class="message-content">
            <div class="message-avatar ${sender==='user'?'user-avatar':'ai-avatar'}">${sender==='user'?'U':'AI'}</div>
            <div class="message-bubble ${sender==='user'?'user':'ai'}"><div class="message-text">${text}</div></div>
        </div>`;
    container.appendChild(div);
    container.scrollTop=container.scrollHeight;
}

async function sendMessage(){
    const input=document.getElementById('messageInput');
    const text=input.value.trim();
    if(!text) return;
    appendMessage("user", text);
    input.value="";

    try{
        const res=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:text})});
        const data=await res.json();
        appendMessage("ai", data.reply);
    }catch(err){
        appendMessage("ai","Error contacting AI server.");
    }
}

async function generateImage(){
    const prompt=document.getElementById("imagePrompt").value.trim();
    if(!prompt) return;
    appendMessage("user","[Image Prompt] "+prompt);

    try{
        const res=await fetch("/image-gen",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt})});
        const data=await res.json();
        if(data.images){
            data.images.forEach(url=>{
                appendMessage("ai", `<img src="${url}" style="max-width:200px;border-radius:8px;">`);
            });
        } else {
            appendMessage("ai","Image generation failed.");
        }
    }catch(err){
        appendMessage("ai","Error contacting image API.");
    }
}

function loadChat(id){
    // Simply reload page for now (server renders selected chat)
    window.location.href="/?active_chat="+id;
}
</script>
</body>
</html>
