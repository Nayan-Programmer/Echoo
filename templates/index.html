<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EchooAI - AI Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    /* User ke diye gaye original styles */
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family:'Inter', system-ui, sans-serif;color:#fff;background:#000;overflow-x:hidden;}
    :root {
        --primary-500:hsl(172.4, 82.8%, 36.1%);
        --emerald-500:hsl(160, 84.1%, 39.4%);
        --glass-bg:rgba(255,255,255,0.1);
        --glass-dark-bg:rgba(30,41,59,0.8);
        --glass-dark-border:rgba(148,163,184,0.1);
        --radius:1.3rem;
    }
    .background-gradient {position:fixed;inset:0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);opacity:0.9;z-index:-2;}
    .background-overlay {position:fixed;inset:0;background-image:url('https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080');background-size:cover;background-position:center;opacity:0.05;z-index:-1;}
    .app {min-height:100vh;display:flex;flex-direction:column;position:relative;}
    .header {background:var(--glass-dark-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-bottom:1px solid var(--glass-dark-border);z-index:100;}
    .header-content {max-width:1536px;margin:0 auto;padding:0 1.5rem;display:flex;align-items:center;justify-content:space-between;height:4rem;}
    .logo-section {display:flex;align-items:center;gap:.75rem;}
    .logo-icon {
        width:1.8rem;
        height:1.8rem;
        border-radius:var(--radius);
        background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow:0 10px 25px rgba(0,0,0,0.2);
    }
    .logo-img {width:1rem;height:1rem;border-radius:.25rem;}
    .logo-text h1 {font-size:1.25rem;font-weight:700;color:white;margin:0;}
    .logo-text p {font-size:0.75rem; color: #9ca3af; margin:0;}
    .header-actions {display:flex;align-items:center;gap:.75rem;}
    .header-btn {padding:.5rem 1rem;border-radius:.5rem;background:var(--glass-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid var(--glass-dark-border);color:white;cursor:pointer;transition:all .2s ease;}
    .header-btn:hover {background:rgba(255,255,255,0.2);transform:translateY(-1px);}
    .main-content {flex:1;display:flex;flex-direction:column;max-width:64rem;margin:0 auto;width:100%;padding:1.5rem;gap:1.5rem;}
    .welcome-screen {flex:1;display:flex;align-items:center;justify-content:center;animation:fadeIn .5s ease-in-out;}
    .welcome-content {text-align:center;max-width:32rem;margin:0 auto;}
    .welcome-logo {width:5rem;height:5rem;margin:0 auto 2rem;background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 20px 50px rgba(0,0,0,0.3);}
    .welcome-logo-img {width:2rem;height:2rem;border-radius:.5rem;}
    .welcome-title {font-size:2.5rem;font-weight:700;color:white;margin-bottom:1rem;}
    .welcome-description {font-size:1.25rem;color:#d1d5db;margin-bottom:2rem;line-height:1.75;}
    .start-chat-btn {display:inline-flex;align-items:center;gap:.5rem;padding:1rem 2rem;background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);color:white;font-weight:600;border:none;border-radius:var(--radius);cursor:pointer;transition:all .3s ease;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
    .start-chat-btn:hover {box-shadow:0 20px 40px rgba(0,0,0,0.3);transform:scale(1.05);}
    .chat-area {flex:1;display:flex;flex-direction:column;animation:fadeIn .5s ease-in-out;}
    .messages-container {flex:1;background:var(--glass-dark-bg);backdrop-filter:blur(10px);border:1px solid var(--glass-dark-border);border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem;min-height:400px;max-height:60vh;overflow-y:auto;}
    .messages-container::-webkit-scrollbar {width:8px;background:transparent;}
    .messages-container::-webkit-scrollbar-thumb {background:rgba(255, 255, 255, 0.2);border-radius:10px;}
    .message {display:flex;margin-bottom:1rem;animation:fadeIn .5s ease-in-out;}
    .message.user {justify-content:flex-end;}
    .message-content {max-width:70%;display:flex;align-items:flex-start;gap:.75rem;}
    .message.user .message-content {flex-direction:row-reverse;}
    .message-avatar {width:2rem;height:2rem;border-radius:.5rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
    .ai-avatar {background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);color:white;}
    .user-avatar {background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%);color:white;font-size:.75rem;font-weight:600;}
    .message-bubble {border-radius:1rem;padding:.75rem 1rem;position:relative;}
    .message-bubble.ai {background:rgba(248,250,252,0.9);backdrop-filter:blur(10px);border:1px solid rgba(226,232,240,0.3);color:#374151;}
    .message-bubble.user {background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);color:white;}
    .message-text {white-space:pre-wrap;line-height:1.5;}
    .message-input-container {animation:slideUp .3s ease-out;}
    .message-input-wrapper {background:var(--glass-dark-bg);backdrop-filter:blur(10px);border:1px solid var(--glass-dark-border);border-radius:1rem;padding:1rem;}
    .input-area {display:flex;align-items:flex-end;gap:1rem;margin-bottom:.75rem;}
    #messageInput {flex:1;background:rgba(255,255,255,0.1);border:none;border-radius:var(--radius);padding:.75rem 3rem .75rem 1rem;color:white;font-family:inherit;font-size:1rem;resize:none;min-height:2.75rem;max-height:8rem;outline:none;transition:all .2s ease;scrollbar-width:none;-ms-overflow-style:none;}
    #messageInput::-webkit-scrollbar {display:none;}
    #messageInput::placeholder {color:#9ca3af;}
    #messageInput:focus {background:rgba(255,255,255,0.15);box-shadow:0 0 0 2px var(--primary-500);}
    .send-btn {background:linear-gradient(135deg,var(--primary-500) 0%,var(--emerald-500) 100%);border:none;border-radius:var(--radius);padding:.75rem;color:white;cursor:pointer;transition:all .2s ease;box-shadow:0 4px 15px rgba(0,0,0,0.2);flex-shrink:0;}
    .send-btn:hover:not(:disabled) {box-shadow:0 6px 20px rgba(0,0,0,0.3);transform:scale(1.05);}
    .send-btn:disabled {opacity:.5;cursor:not-allowed;transform:none;}
    .footer {background:var(--glass-dark-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-top:1px solid var(--glass-dark-border);margin-top:auto;}
    .footer-content {max-width:64rem;margin:0 auto;padding:1rem 1.5rem;display:flex;align-items:center;justify-content:space-between;font-size:.875rem;color:#9ca3af;}
    .footer-left {display:flex;align-items:center;gap:1rem;}
    .separator {width:.25rem;height:.25rem;background:#6b7280;border-radius:50%;}
    .footer-link {color:#9ca3af;text-decoration:none;transition:color .2s ease;}
    .footer-link:hover {color:var(--primary-500);}
    .footer-right {display:flex;align-items:center;gap:.5rem;}
    .status-indicator {width:.5rem;height:.5rem;background:var(--emerald-500);border-radius:50%;animation:pulse 2s infinite;}
    .status-text {color:var(--emerald-500);}
    @keyframes fadeIn {0%{opacity:0;transform:translateY(10px);}100%{opacity:1;transform:translateY(0);}}
    @keyframes slideUp {0%{transform:translateY(100%);}100%{transform:translateY(0);}}
    @keyframes pulse {0%,100%{opacity:1;}50%{opacity:0.5;}}

    /* New styles for sidebar, login, and profile */
    .main-layout {
        display: flex;
        min-height: calc(100vh - 4rem);
    }
    .sidebar {
        width: 250px;
        background: var(--glass-dark-bg);
        backdrop-filter: blur(10px);
        border-right: 1px solid var(--glass-dark-border);
        padding: 1.5rem 1rem;
        display: none; /* Default hidden, will be shown on login */
        flex-direction: column;
        gap: 0.5rem;
        transition: transform 0.3s ease-in-out;
        transform: translateX(0);
    }
    .sidebar-link {
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        color: #9ca3af;
        text-decoration: none;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 1rem;
        font-weight: 500;
    }
    .sidebar-link i {
        font-size: 1.25rem;
    }
    .sidebar-link:hover, .sidebar-link.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }
    #userProfile {
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--glass-dark-border);
        margin-bottom: 1.5rem;
    }
    #userAvatar {
        width: 4rem;
        height: 4rem;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 0.75rem;
        border: 2px solid white;
    }
    #userName {
        font-size: 1.125rem;
        font-weight: 600;
        margin: 0;
    }
    #userIdDisplay {
        font-size: 0.75rem;
        color: #9ca3af;
        word-break: break-all;
        margin-top: 0.25rem;
    }
    .login-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
        color: white;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
    }
    .login-btn i {
        font-size: 1rem;
    }
    .login-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .loader {
        border: 4px solid #f3f3f3;
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 20px;
        height: 20px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
        display: none;
        margin: 0 auto;
    }
    @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</head>
<body>
<div class="app">
    <div class="background-gradient"></div>
    <div class="background-overlay"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="https://placehold.co/60x60/3CB371/FFFFFF?text=AI" alt="Logo" class="logo-img">
                </div>
                <div class="logo-text">
                    <h1>EchooAI</h1>
                    <p>Premium Chatbot</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="loginBtn" class="login-btn"><i class="fab fa-google"></i> Login with Google</button>
                <div id="authStatus" style="display:none; align-items:center; gap:0.5rem;">
                    <span id="userNameDisplay"></span>
                    <button id="logoutBtn" class="header-btn">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div id="userProfile">
                <img id="userAvatar" src="https://placehold.co/100x100/3498db/FFFFFF?text=U" alt="User Avatar">
                <h3 id="userName">Guest</h3>
                <p id="userIdDisplay">User ID: N/A</p>
            </div>
            <a href="#" class="sidebar-link active"><i class="fas fa-home"></i> Home</a>
            <a href="#" class="sidebar-link"><i class="fas fa-history"></i> History</a>
            <a href="#" class="sidebar-link"><i class="fas fa-cog"></i> Settings</a>
        </div>
        
        <main class="main-content">
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-logo">
                        <img src="https://placehold.co/60x60/3CB371/FFFFFF?text=AI" alt="Logo" class="welcome-logo-img">
                    </div>
                    <h2 class="welcome-title">Welcome to EchooAI</h2>
                    <p class="welcome-description">Your AI assistant for everything. Please log in to start chatting!</p>
                </div>
            </div>

            <div class="chat-area" id="chatArea" style="display:none;">
                <div class="messages-container" id="messagesContainer">
                    <div id="loadingIndicator" class="loader"></div>
                </div>
                <div class="message-input-container">
                    <div class="message-input-wrapper">
                        <div class="input-area">
                            <textarea id="messageInput" placeholder="Type your message..."></textarea>
                            <button class="send-btn" id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <span>&copy; 2025 EchooAI</span>
                <div class="separator"></div>
                <a href="#" class="footer-link">Privacy</a>
            </div>
            <div class="footer-right">
                <div class="status-indicator"></div>
                <span class="status-text">Online</span>
            </div>
        </div>
    </footer>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>

<script>
    // Platform se milne wale global variables
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    // Firebase services ko initialize karein
    let app, auth, db, userId;

    // Chat UI elements
    const welcomeScreen = document.getElementById('welcomeScreen');
    const chatArea = document.getElementById('chatArea');
    const messagesContainer = document.getElementById('messagesContainer');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const sidebar = document.getElementById('sidebar');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const authStatusDiv = document.getElementById('authStatus');
    const userProfileDiv = document.getElementById('userProfile');
    const userAvatarImg = document.getElementById('userAvatar');
    const userNameDisplay = document.getElementById('userNameDisplay');
    const userIdDisplay = document.getElementById('userIdDisplay');
    const loadingIndicator = document.getElementById('loadingIndicator');

    // UI state ko update karne ke liye function
    function updateUIForAuth(user) {
        if (user) {
            // User logged in hai
            welcomeScreen.style.display = 'none';
            chatArea.style.display = 'flex';
            sidebar.style.display = 'flex';
            loginBtn.style.display = 'none';
            authStatusDiv.style.display = 'flex';
            userProfileDiv.style.display = 'flex';
            
            userId = user.uid;
            userNameDisplay.innerText = user.displayName || 'User';
            userIdDisplay.innerText = `User ID: ${userId}`;
            userAvatarImg.src = user.photoURL || 'https://placehold.co/100x100/3498db/FFFFFF?text=U';
            
            // Chat history ko load karein
            loadChatHistory();
        } else {
            // User logged out hai
            welcomeScreen.style.display = 'flex';
            chatArea.style.display = 'none';
            sidebar.style.display = 'none';
            loginBtn.style.display = 'inline-flex';
            authStatusDiv.style.display = 'none';
            userProfileDiv.style.display = 'none';
            messagesContainer.innerHTML = '';
            userId = null;
        }
    }

    // Google Sign-in Pop-up
    async function signInWithGoogle() {
        try {
            const provider = new firebase.auth.GoogleAuthProvider();
            await firebase.auth().signInWithPopup(provider);
        } catch (error) {
            console.error("Google login error:", error);
            // Error handling UI (custom modal) yahan add kar sakte hain
        }
    }

    // Logout function
    async function signOut() {
        try {
            await firebase.auth().signOut();
        } catch (error) {
            console.error("Logout error:", error);
        }
    }

    // Chat history ko Firestore se load karein
    function loadChatHistory() {
        if (!userId) return;
        
        loadingIndicator.style.display = 'block';
        
        const chatPath = `/artifacts/${appId}/users/${userId}/chats`;
        const q = firebase.firestore().collection(chatPath).orderBy("timestamp");
        
        // onSnapshot se real-time updates milengi
        firebase.firestore().onSnapshot(q, (querySnapshot) => {
            messagesContainer.innerHTML = ''; // Purane messages clear karein
            querySnapshot.forEach((doc) => {
                const chatData = doc.data();
                appendMessageToUI(chatData.text, chatData.isUser);
            });
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            loadingIndicator.style.display = 'none';
        }, (error) => {
            console.error("Error loading chat history:", error);
            loadingIndicator.style.display = 'none';
        });
    }

    // UI mein naya message add karein
    function appendMessageToUI(text, isUser) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
        const avatarText = isUser ? (firebase.auth().currentUser?.displayName?.charAt(0) || 'U') : 'AI';
        
        messageDiv.innerHTML = `
            <div class="message-content">
                <div class="message-avatar ${isUser ? 'user-avatar' : 'ai-avatar'}">${avatarText}</div>
                <div class="message-bubble ${isUser ? 'user' : 'ai'}"><div class="message-text">${text}</div></div>
            </div>`;
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Chat server ko message bhejkar reply receive karein
    async function getAIResponse(prompt) {
        // Dummy AI response function, as backend is not available
        return new Promise(resolve => {
            setTimeout(() => {
                const reply = `Hi there! You said: "${prompt}". I'm a simple AI assistant. Your chat history is now saved!`;
                resolve(reply);
            }, 1000); // 1 second ka delay simulate karein
        });
    }

    // Chat message ko send aur save karein
    async function sendMessage() {
        const text = messageInput.value.trim();
        if (!text || !userId) return;

        messageInput.value = '';
        messageInput.disabled = true;
        sendBtn.disabled = true;

        // User ka message Firestore mein save karein
        await firebase.firestore().collection(`/artifacts/${appId}/users/${userId}/chats`).add({
            text: text,
            isUser: true,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // AI se response lekar Firestore mein save karein
        const aiReply = await getAIResponse(text);
        await firebase.firestore().collection(`/artifacts/${appId}/users/${userId}/chats`).add({
            text: aiReply,
            isUser: false,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        messageInput.disabled = false;
        sendBtn.disabled = false;
        messageInput.focus();
    }

    // Event Listeners
    loginBtn.addEventListener('click', signInWithGoogle);
    logoutBtn.addEventListener('click', signOut);
    messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    // Firebase ko initialize karein aur auth state ko listen karein
    window.onload = function() {
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();

            // Initial auth token ke saath sign-in karein
            if (initialAuthToken) {
                auth.signInWithCustomToken(initialAuthToken).catch(error => {
                    console.error("Custom token login failed:", error);
                    // Agar custom token fail ho to anonymous sign-in
                    auth.signInAnonymously().catch(anonError => {
                        console.error("Anonymous login failed:", anonError);
                    });
                });
            } else {
                // Agar token nahi hai to anonymous sign-in
                auth.signInAnonymously().catch(anonError => {
                    console.error("Anonymous login failed:", anonError);
                });
            }

            // Auth state change ko listen karein
            auth.onAuthStateChanged((user) => {
                updateUIForAuth(user);
            });

        } catch (e) {
            console.error("Firebase initialization failed:", e);
        }
    };

</script>
</body>
</html>
